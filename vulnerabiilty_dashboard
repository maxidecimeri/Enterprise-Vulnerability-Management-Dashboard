import requests
import pandas as pd
from flask import Flask, render_template
import plotly.express as px

app = Flask(__name__)

# Function to fetch data from Qualys API
def fetch_qualys_data():
    # Example API call (replace with actual API integration)
    response = requests.get("https://qualysapi.com/api/v1/vulnerabilities")
    data = response.json()
    return pd.DataFrame(data)

# Function to fetch data from Tenable API
def fetch_tenable_data():
    # Example API call (replace with actual API integration)
    response = requests.get("https://tenableapi.com/api/v1/vulnerabilities")
    data = response.json()
    return pd.DataFrame(data)

# Function to merge and normalize data
def normalize_data():
    qualys_df = fetch_qualys_data()
    tenable_df = fetch_tenable_data()
    merged_df = pd.concat([qualys_df, tenable_df])
    # Further normalization steps
    return merged_df

# Function to generate a dashboard
def create_dashboard():
    data = normalize_data()
    fig = px.bar(data, x="severity", y="count", color="source")
    return fig.to_html()

@app.route("/")
def dashboard():
    dashboard_html = create_dashboard()
    return render_template("dashboard.html", dashboard_html=dashboard_html)

if __name__ == "__main__":
    app.run(debug=True)
